---
description: Правила тестирования. Обязательное добавление и обновление тестов при разработке.
alwaysApply: true
---

# Testing Requirements

## Обязательные требования к тестированию

### При создании нового функционала

1. **Обязательное создание тестов**: При добавлении нового функционала (компоненты, утилиты, хуки, сервисы) ОБЯЗАТЕЛЬНО создавать соответствующие тесты.

2. **Структура тестов**:
   - Тесты располагаются в папке `__tests__` рядом с тестируемым файлом
   - Имя тестового файла: `{имя_файла}.test.{ts|tsx}`
   - Моки для модулей располагаются в папке `__mocks__` рядом с исходным файлом

3. **Покрытие тестами**:
   - Компоненты: проверка рендеринга, пропсов, пользовательских взаимодействий
   - Утилиты: проверка всех путей выполнения, граничных случаев, обработки ошибок
   - Хуки: проверка состояний, эффектов, возвращаемых значений
   - Сервисы: проверка вызовов API, обработки данных, обработки ошибок

4. **Пример структуры**:
   ```
   src/
   ├── features/
   │   └── accounts/
   │       ├── components/
   │       │   ├── AccountCard.tsx
   │       │   └── __tests__/
   │       │       └── AccountCard.test.tsx
   │       └── hooks/
   │           ├── useAccounts.ts
   │           └── __tests__/
   │               └── useAccounts.test.ts
   ```

### При изменении существующего функционала

1. **Обязательное обновление тестов**: При изменении существующего функционала ОБЯЗАТЕЛЬНО обновлять соответствующие тесты.

2. **Проверка актуальности**:
   - Если функционал изменился, тесты должны отражать новое поведение
   - Если тесты падают после изменений, это нормально - нужно обновить тесты
   - НЕ удалять тесты без замены их новыми, если функционал был изменен

3. **Добавление новых тестов**:
   - Если добавлена новая функциональность к существующему компоненту/функции, добавить тесты для новой функциональности
   - Если изменена логика обработки ошибок, добавить тесты для новых сценариев

4. **Рефакторинг тестов**:
   - При рефакторинге кода обновить тесты для соответствия новой структуре
   - Убедиться, что все тесты проходят после изменений

### Правила написания тестов

1. **Использование Testing Library**:
   - Использовать `@testing-library/react` для тестирования компонентов
   - Использовать `@testing-library/user-event` для симуляции пользовательских действий
   - Избегать тестирования внутренней реализации, фокусироваться на поведении

2. **Именование тестов**:
   - Использовать описательные имена: `should render correctly`, `should handle user input`, `should throw error on invalid input`
   - Группировать связанные тесты в `describe` блоки

3. **Моки и стабы**:
   - Мокировать внешние зависимости (API, библиотеки)
   - Использовать папку `__mocks__` для моков модулей
   - Избегать излишнего мокирования - тестировать реальное поведение где возможно

4. **Проверка покрытия**:
   - Запускать `npm run test:coverage` для проверки покрытия
   - Стремиться к покрытию критического функционала (минимум 80% для бизнес-логики)

### Запуск тестов

```bash
# Запуск всех тестов
npm run test

# Запуск тестов в watch режиме
npm run test:watch

# Запуск тестов с покрытием
npm run test:coverage
```

### Интеграция в CI/CD

- Все тесты должны проходить в CI pipeline перед деплоем
- Тесты запускаются автоматически при каждом push и pull request
- Покрытие тестами отслеживается и отображается в CI

### Исключения

Тесты НЕ требуются для:
- Простых констант и конфигураций (если они не содержат логику)
- Типов TypeScript (type definitions)
- Файлов с только экспортами (re-exports)

# If this rule was applied, display at the beginning of the response: "Applied: testing RULE ⓵"
